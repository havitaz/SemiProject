<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 8 (8.5.92) - The Tomcat JDBC Connection Pool</title><meta name="author" content="Filip Hanik"></head><body><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat Home" src="./images/tomcat.png"></a></div><div style="height: 1px;"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="The Apache Software Foundation" style="width: 266px; height: 83px;"></a></div><h1>Apache Tomcat 8</h1><div class="versionInfo">
            Version 8.5.92,
            <time datetime="2023-08-09">Aug 9 2023</time></div><div style="height: 1px;"></div><div style="clear: left;"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>Links</h2><ul><li><a href="index.html">Docs Home</a></li><li><a href="https://cwiki.apache.org/confluence/display/TOMCAT/FAQ">FAQ</a></li><li><a href="#comments_section">User Comments</a></li></ul></div><div><h2>User Guide</h2><ul><li><a href="introduction.html">1) Introduction</a></li><li><a href="setup.html">2) Setup</a></li><li><a href="appdev/index.html">3) First webapp</a></li><li><a href="deployer-howto.html">4) Deployer</a></li><li><a href="manager-howto.html">5) Manager</a></li><li><a href="host-manager-howto.html">6) Host Manager</a></li><li><a href="realm-howto.html">7) Realms and AAA</a></li><li><a href="security-manager-howto.html">8) Security Manager</a></li><li><a href="jndi-resources-howto.html">9) JNDI Resources</a></li><li><a href="jndi-datasource-examples-howto.html">10) JDBC DataSources</a></li><li><a href="class-loader-howto.html">11) Classloading</a></li><li><a href="jasper-howto.html">12) JSPs</a></li><li><a href="ssl-howto.html">13) SSL/TLS</a></li><li><a href="ssi-howto.html">14) SSI</a></li><li><a href="cgi-howto.html">15) CGI</a></li><li><a href="proxy-howto.html">16) Proxy Support</a></li><li><a href="mbeans-descriptors-howto.html">17) MBeans Descriptors</a></li><li><a href="default-servlet.html">18) Default Servlet</a></li><li><a href="cluster-howto.html">19) Clustering</a></li><li><a href="balancer-howto.html">20) Load Balancer</a></li><li><a href="connectors.html">21) Connectors</a></li><li><a href="monitoring.html">22) Monitoring and Management</a></li><li><a href="logging.html">23) Logging</a></li><li><a href="apr.html">24) APR/Native</a></li><li><a href="virtual-hosting-howto.html">25) Virtual Hosting</a></li><li><a href="aio.html">26) Advanced IO</a></li><li><a href="extras.html">27) Additional Components</a></li><li><a href="maven-jars.html">28) Mavenized</a></li><li><a href="security-howto.html">29) Security Considerations</a></li><li><a href="windows-service-howto.html">30) Windows Service</a></li><li><a href="windows-auth-howto.html">31) Windows Authentication</a></li><li><a href="jdbc-pool.html">32) Tomcat's JDBC Pool</a></li><li><a href="web-socket-howto.html">33) WebSocket</a></li><li><a href="rewrite.html">34) Rewrite</a></li></ul></div><div><h2>Reference</h2><ul><li><a href="RELEASE-NOTES.txt">Release Notes</a></li><li><a href="config/index.html">Configuration</a></li><li><a href="api/index.html">Tomcat Javadocs</a></li><li><a href="servletapi/index.html">Servlet 3.1 Javadocs</a></li><li><a href="jspapi/index.html">JSP 2.3 Javadocs</a></li><li><a href="elapi/index.html">EL 3.0 Javadocs</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Javadocs</a></li><li><a href="jaspicapi/index.html">JASPIC 1.1 Javadocs</a></li><li><a href="annotationapi/index.html">Common Annotations 1.2 Javadocs</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2 Documentation</a></li></ul></div><div><h2>Apache Tomcat Development</h2><ul><li><a href="building.html">Building</a></li><li><a href="changelog.html">Changelog</a></li><li><a href="https://cwiki.apache.org/confluence/display/TOMCAT/Tomcat+Versions">Status</a></li><li><a href="developers.html">Developers</a></li><li><a href="architecture/index.html">Architecture</a></li><li><a href="tribes/introduction.html">Tribes</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>The Tomcat JDBC Connection Pool</h2><h3 id="Table_of_Contents">Table of Contents</h3><div class="text">
<ul><li><a href="#Introduction">Introduction</a></li><li><a href="#How_to_use">How to use</a><ol><li><a href="#Additional_features">Additional features</a></li><li><a href="#Inside_the_Apache_Tomcat_Container">Inside the Apache Tomcat Container</a></li><li><a href="#Standalone">Standalone</a></li><li><a href="#JMX">JMX</a></li></ol></li><li><a href="#Attributes">Attributes</a><ol><li><a href="#JNDI_Factory_and_Type">JNDI Factory and Type</a></li><li><a href="#System_Properties">System Properties</a></li><li><a href="#Common_Attributes">Common Attributes</a></li><li><a href="#Tomcat_JDBC_Enhanced_Attributes">Tomcat JDBC Enhanced Attributes</a></li></ol></li><li><a href="#Advanced_usage">Advanced usage</a><ol><li><a href="#JDBC_interceptors">JDBC interceptors</a></li><li><a href="#Configuring_JDBC_interceptors">Configuring JDBC interceptors</a></li><li><a href="#org.apache.tomcat.jdbc.pool.JdbcInterceptor">org.apache.tomcat.jdbc.pool.JdbcInterceptor</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.ConnectionState">org.apache.tomcat.jdbc.pool.interceptor.ConnectionState</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer">org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.StatementCache">org.apache.tomcat.jdbc.pool.interceptor.StatementCache</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.StatementDecoratorInterceptor">org.apache.tomcat.jdbc.pool.interceptor.StatementDecoratorInterceptor</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.QueryTimeoutInterceptor">org.apache.tomcat.jdbc.pool.interceptor.QueryTimeoutInterceptor</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReport">org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReport</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReportJmx">org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReportJmx</a></li><li><a href="#org.apache.tomcat.jdbc.pool.interceptor.ResetAbandonedTimer">org.apache.tomcat.jdbc.pool.interceptor.ResetAbandonedTimer</a></li></ol></li><li><a href="#Code_Example">Code Example</a><ol><li><a href="#Plain_Ol'_Java">Plain Ol' Java</a></li><li><a href="#As_a_Resource">As a Resource</a></li><li><a href="#Asynchronous_Connection_Retrieval">Asynchronous Connection Retrieval</a></li><li><a href="#Interceptors">Interceptors</a></li><li><a href="#Getting_the_actual_JDBC_connection">Getting the actual JDBC connection</a></li></ol></li><li><a href="#Building">Building</a><ol><li><a href="#Building_from_source">Building from source</a></li></ol></li></ul>
</div><h3 id="Introduction">Introduction</h3><div class="text">

  <p>The <strong>JDBC Connection Pool <code>org.apache.tomcat.jdbc.pool</code></strong>
  is a replacement or an alternative to the <a href="https://commons.apache.org/dbcp/">Apache Commons DBCP</a>
  connection pool.</p>

  <p>So why do we need a new connection pool?</p>

  <p>Here are a few of the reasons:</p>
    <ol>
      <li>Commons DBCP 1.x is single threaded. In order to be thread safe
          Commons locks the entire pool for short periods during both object
          allocation and object return. Note that this does not apply to
          Commons DBCP 2.x.</li>
      <li>Commons DBCP 1.x can be slow. As the number of logical CPUs grows and
          the number of concurrent threads attempting to borrow or return
          objects increases, the performance suffers. For highly concurrent
          systems the impact can be significant. Note that this does not apply
          to Commons DBCP 2.x.</li>
      <li>Commons DBCP is over 60 classes. tomcat-jdbc-pool core is 8 classes,
          hence modifications for future requirement will require much less
          changes. This is all you need to run the connection pool itself, the
          rest is gravy.</li>
      <li>Commons DBCP uses static interfaces. This means you have to use the
          right version for a given JRE version or you may see
          <code>NoSuchMethodException</code> exceptions.</li>
      <li>It's not worth rewriting over 60 classes, when a connection pool can
          be accomplished with a much simpler implementation.</li>
      <li>Tomcat jdbc pool implements the ability retrieve a connection
          asynchronously, without adding additional threads to the library
          itself.</li>
      <li>Tomcat jdbc pool is a Tomcat module, it depends on Tomcat JULI, a
          simplified logging framework used in Tomcat.</li>
      <li>Retrieve the underlying connection using the
          <code>javax.sql.PooledConnection</code> interface.</li>
      <li>Starvation proof. If a pool is empty, and threads are waiting for a
          connection, when a connection is returned, the pool will awake the
          correct thread waiting. Most pools will simply starve.</li>
    </ol>

  <p>Features added over other connection pool implementations</p>
    <ol>
      <li>Support for highly concurrent environments and multi core/cpu systems.</li>
      <li>Dynamic implementation of interface, will support <code>java.sql</code> and <code>javax.sql</code> interfaces for
          your runtime environment (as long as your JDBC driver does the same), even when compiled with a lower version of the JDK.</li>
      <li>Validation intervals - we don't have to validate every single time we use the connection, we can do this
          when we borrow or return the connection, just not more frequent than an interval we can configure.</li>
      <li>Run-Once query, a configurable query that will be run only once, when the connection to the database is established.
          Very useful to setup session settings, that you want to exist during the entire time the connection is established.</li>
      <li>Ability to configure custom interceptors.
          This allows you to write custom interceptors to enhance the functionality. You can use interceptors to gather query stats,
          cache session states, reconnect the connection upon failures, retry queries, cache query results, and so on.
          Your options are endless and the interceptors are dynamic, not tied to a JDK version of a
          <code>java.sql</code>/<code>javax.sql</code> interface.</li>
      <li>High performance - we will show some differences in performance later on</li>
      <li>Extremely simple, due to the very simplified implementation, the line count and source file count are very low, compare with c3p0
          that has over 200 source files(last time we checked), Tomcat jdbc has a core of 8 files, the connection pool itself is about half
          that. As bugs may occur, they will be faster to track down, and easier to fix. Complexity reduction has been a focus from inception.</li>
      <li>Asynchronous connection retrieval - you can queue your request for a connection and receive a <code>Future&lt;Connection&gt;</code> back.</li>
      <li>Better idle connection handling. Instead of closing connections directly, it can still pool connections and sizes the idle pool with a smarter algorithm.</li>
      <li>You can decide at what moment connections are considered abandoned, is it when the pool is full, or directly at a timeout
          by specifying a pool usage threshold.
      </li>
      <li>The abandon connection timer will reset upon a statement/query activity. Allowing a connections that is in use for a long time to not timeout.
          This is achieved using the <code>ResetAbandonedTimer</code>
      </li>
      <li>Close connections after they have been connected for a certain time. Age based close upon return to the pool.
      </li>
      <li>Get JMX notifications and log entries when connections are suspected for being abandoned. This is similar to
          the <code>removeAbandonedTimeout</code> but it doesn't take any action, only reports the information.
          This is achieved using the <code>suspectTimeout</code> attribute.</li>
      <li>Connections can be retrieved from a <code>java.sql.Driver</code>, <code>javax.sql.DataSource</code> or <code>javax.sql.XADataSource</code>
          This is achieved using the <code>dataSource</code> and <code>dataSourceJNDI</code> attributes.</li>
      <li>XA connection support</li>
    </ol>


</div><h3 id="How_to_use">How to use</h3><div class="text">
  <p>
    Usage of the Tomcat connection pool has been made to be as simple as possible, for those of you that are familiar with commons-dbcp, the
    transition will be very simple. Moving from other connection pools is also fairly straight forward.
  </p>
  <div class="subsection"><h4 id="Additional_features">Additional features</h4><div class="text">
    <p>The Tomcat connection pool offers a few additional features over what most other pools let you do:</p>
    <ul>
      <li><code>initSQL</code> - the ability to run an SQL statement exactly once, when the connection is created</li>
      <li><code>validationInterval</code> - in addition to running validations on connections, avoid running them too frequently.</li>
      <li><code>jdbcInterceptors</code> - flexible and pluggable interceptors to create any customizations around the pool,
          the query execution and the result set handling. More on this in the advanced section.</li>
      <li><code>fairQueue</code> - Set the fair flag to true to achieve thread fairness or to use asynchronous connection retrieval</li>
    </ul>
  </div></div>
  <div class="subsection"><h4 id="Inside_the_Apache_Tomcat_Container">Inside the Apache Tomcat Container</h4><div class="text">
    <p>
      The Tomcat Connection pool is configured as a resource described in <a href="http://tomcat.apache.org/tomcat-8.5-doc/jndi-datasource-examples-howto.html" target="_blank">The Tomcat JDBC documentation</a>
      With the only difference being that you have to specify the <code>factory</code> attribute and set the value to
      <code>org.apache.tomcat.jdbc.pool.DataSourceFactory</code>
    </p>
  </div></div>
  <div class="subsection"><h4 id="Standalone">Standalone</h4><div class="text">
    <p>
      The connection pool only has another dependency, and that is on tomcat-juli.jar.
      To configure the pool in a stand alone project using bean instantiation, the bean to instantiate is
      <code>org.apache.tomcat.jdbc.pool.DataSource</code>. The same attributes (documented below) as you use to configure a connection
      pool as a JNDI resource, are used to configure a data source as a bean.
    </p>
  </div></div>
  <div class="subsection"><h4 id="JMX">JMX</h4><div class="text">
    <p>
      The connection pool object exposes an MBean that can be registered.
      In order for the connection pool object to create the MBean, the flag <code>jmxEnabled</code> has to be set to true.
      This doesn't imply that the pool will be registered with an MBean server, merely that the MBean is created.
      In a container like Tomcat, Tomcat itself registers the DataSource with the MBean server, the
      <code>org.apache.tomcat.jdbc.pool.DataSource</code> object will then register the actual
      connection pool MBean.
      If you're running outside of a container, you can register the DataSource yourself under any object name you specify,
      and it propagates the registration to the underlying pool. To do this you would call <code>mBeanServer.registerMBean(dataSource.getPool().getJmxPool(),objectname)</code>.
      Prior to this call, ensure that the pool has been created by calling <code>dataSource.createPool()</code>.
    </p>
  </div></div>

</div><h3 id="Attributes">Attributes</h3><div class="text">
  <p>To provide a very simple switch to and from commons-dbcp and tomcat-jdbc-pool,
     Most attributes are the same and have the same meaning.</p>
  <div class="subsection"><h4 id="JNDI_Factory_and_Type">JNDI Factory and Type</h4><div class="text">
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><strong><code class="attributeName">factory</code></strong></td><td>
        <p>factory is required, and the value should be <code>org.apache.tomcat.jdbc.pool.DataSourceFactory</code></p>
      </td></tr><tr><td><strong><code class="attributeName">type</code></strong></td><td>
        <p>Type should always be <code>javax.sql.DataSource</code> or <code>javax.sql.XADataSource</code></p>
        <p>Depending on the type a <code>org.apache.tomcat.jdbc.pool.DataSource</code> or a <code>org.apache.tomcat.jdbc.pool.XADataSource</code> will be created.</p>
      </td></tr></table>
  </div></div>

  <div class="subsection"><h4 id="System_Properties">System Properties</h4><div class="text">
    <p>System properties are JVM wide, affect all pools created in the JVM</p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><code class="attributeName">org.apache.tomcat.jdbc.pool.onlyAttemptCurrentClassLoader</code></td><td>
        <p>(boolean) Controls classloading of dynamic classes, such as
           JDBC drivers, interceptors and validators. If set to
           <code>false</code>, default value, the pool will first attempt
           to load using the current loader (i.e. the class loader that
           loaded the pool classes) and if class loading fails attempt to
           load using the thread context loader. Set this value to
           <code>true</code>, if you wish to remain backwards compatible
           with Apache Tomcat 8.0.8 and earlier, and only attempt the
           current loader.
           If not set then the default value is <code>false</code>.
        </p>
      </td></tr></table>
  </div></div>

  <div class="subsection"><h4 id="Common_Attributes">Common Attributes</h4><div class="text">
  <p>These attributes are shared between commons-dbcp and tomcat-jdbc-pool, in some cases default values are different.</p>
  <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><code class="attributeName">defaultAutoCommit</code></td><td>
      <p>(boolean) The default auto-commit state of connections created by this pool. If not set, default is JDBC driver default (If not set then the <code>setAutoCommit</code> method will not be called.)</p>
    </td></tr><tr><td><code class="attributeName">defaultReadOnly</code></td><td>
      <p>(boolean) The default read-only state of connections created by this pool. If not set then the <code>setReadOnly</code> method will not be called. (Some drivers don't support read only mode, ex: Informix)</p>
    </td></tr><tr><td><code class="attributeName">defaultTransactionIsolation</code></td><td>
      <p>(String) The default TransactionIsolation state of connections created by this pool. One of the following: (see javadoc )</p>
         <ul>
           <li><code>NONE</code></li>
           <li><code>READ_COMMITTED</code></li>
           <li><code>READ_UNCOMMITTED</code></li>
           <li><code>REPEATABLE_READ</code></li>
           <li><code>SERIALIZABLE</code></li>
         </ul>
         <p>If not set, the method will not be called and it defaults to the JDBC driver.</p>
    </td></tr><tr><td><code class="attributeName">defaultCatalog</code></td><td>
      <p>(String) The default catalog of connections created by this pool.</p>
    </td></tr><tr><td><strong><code class="attributeName">driverClassName</code></strong></td><td>
      <p>(String) The fully qualified Java class name of the JDBC driver to be used. The driver has to be accessible
         from the same classloader as tomcat-jdbc.jar
      </p>
    </td></tr><tr><td><strong><code class="attributeName">username</code></strong></td><td>
      <p>(String) The connection username to be passed to our JDBC driver to establish a connection.
         Note that method <code>DataSource.getConnection(username,password)</code>
         by default will not use credentials passed into the method,
         but will use the ones configured here. See <code>alternateUsernameAllowed</code>
         property for more details.
      </p>
    </td></tr><tr><td><strong><code class="attributeName">password</code></strong></td><td>
      <p>(String) The connection password to be passed to our JDBC driver to establish a connection.
         Note that method <code>DataSource.getConnection(username,password)</code>
         by default will not use credentials passed into the method,
         but will use the ones configured here. See <code>alternateUsernameAllowed</code>
         property for more details.
      </p>
    </td></tr><tr><td><code class="attributeName">maxActive</code></td><td>
      <p>(int) The maximum number of active connections that can be allocated from this pool at the same time.
         The default value is <code>100</code></p>
    </td></tr><tr><td><code class="attributeName">maxIdle</code></td><td>
      <p>(int) The maximum number of connections that should be kept in the pool at all times.
         Default value is  <code>maxActive</code>:<code>100</code>
         Idle connections are checked periodically (if enabled) and
         connections that been idle for longer than <code>minEvictableIdleTimeMillis</code>
         will be released. (also see <code>testWhileIdle</code>)</p>
    </td></tr><tr><td><code class="attributeName">minIdle</code></td><td>
      <p>
        (int) The minimum number of established connections that should be kept in the pool at all times.
        The connection pool can shrink below this number if validation queries fail.
        Default value is derived from <code>initialSize</code>:<code>10</code> (also see <code>testWhileIdle</code>)
      </p>
    </td></tr><tr><td><code class="attributeName">initialSize</code></td><td>
      <p>(int)The initial number of connections that are created when the pool is started.
         Default value is <code>10</code></p>
    </td></tr><tr><td><code class="attributeName">maxWait</code></td><td>
      <p>(int) The maximum number of milliseconds that the pool will wait (when there are no available connections)
         for a connection to be returned before throwing an exception.
         Default value is <code>30000</code> (30 seconds)</p>
    </td></tr><tr><td><code class="attributeName">testOnBorrow</code></td><td>
      <p>(boolean) The indication of whether objects will be validated before being borrowed from the pool.
         If the object fails to validate, it will be dropped from the pool, and we will attempt to borrow another.
         In order to have a more efficient validation, see <code>validationInterval</code>.
         Default value is <code>false</code>
      </p>
    </td></tr><tr><td><code class="attributeName">testOnConnect</code></td><td>
      <p>(boolean) The indication of whether objects will be validated when a connection is first created.
         If an object fails to validate, it will be throw <code>SQLException</code>.
         Default value is <code>false</code>
      </p>
    </td></tr><tr><td><code class="attributeName">testOnReturn</code></td><td>
      <p>(boolean) The indication of whether objects will be validated before being returned to the pool.
         The default value is <code>false</code>.
      </p>
    </td></tr><tr><td><code class="attributeName">testWhileIdle</code></td><td>
      <p>(boolean) The indication of whether objects will be validated by the idle object evictor (if any).
         If an object fails to validate, it will be dropped from the pool.
         The default value is <code>false</code> and this property has to be set in order for the
         pool cleaner/test thread is to run (also see <code>timeBetweenEvictionRunsMillis</code>)
      </p>
    </td></tr><tr><td><code class="attributeName">validationQuery</code></td><td>
      <p>(String) The SQL query that will be used to validate connections from this pool before returning them to the caller.
         If specified, this query does not have to return any data, it just can't throw a <code>SQLException</code>.
         The default value is <code>null</code>.
         If not specified, connections will be validation by the isValid() method.
         Example values are <code>SELECT 1</code>(mysql), <code>select 1 from dual</code>(oracle), <code>SELECT 1</code>(MS Sql Server)
      </p>
    </td></tr><tr><td><code class="attributeName">validationQueryTimeout</code></td><td>
      <p>(int) The timeout in seconds before a connection validation queries fail.  This works by calling
         <code>java.sql.Statement.setQueryTimeout(seconds)</code> on the statement that executes the <code>validationQuery</code>.
         The pool itself doesn't timeout the query, it is still up to the JDBC driver to enforce query timeouts.
         A value less than or equal to zero will disable this feature.
         The default value is <code>-1</code>.
      </p>
    </td></tr><tr><td><code class="attributeName">validatorClassName</code></td><td>
      <p>(String) The name of a class which implements the
         <code>org.apache.tomcat.jdbc.pool.Validator</code> interface and
         provides a no-arg constructor (may be implicit). If specified, the
         class will be used to create a Validator instance which is then used
         instead of any validation query to validate connections. The default
         value is <code>null</code>. An example value is
         <code>com.mycompany.project.SimpleValidator</code>.
      </p>
    </td></tr><tr><td><code class="attributeName">timeBetweenEvictionRunsMillis</code></td><td>
      <p>(int) The number of milliseconds to sleep between runs of the idle connection validation/cleaner thread.
         This value should not be set under 1 second. It dictates how often we check for idle, abandoned connections, and how often
         we validate idle connections.
         The default value is <code>5000</code> (5 seconds). <br>
      </p>
    </td></tr><tr><td><code class="attributeName">numTestsPerEvictionRun</code></td><td>
      <p>(int) Property not used in tomcat-jdbc-pool.</p>
    </td></tr><tr><td><code class="attributeName">minEvictableIdleTimeMillis</code></td><td>
      <p>(int) The minimum amount of time an object may sit idle in the pool before it is eligible for eviction.
         The default value is <code>60000</code> (60 seconds).</p>
    </td></tr><tr><td><code class="attributeName">accessToUnderlyingConnectionAllowed</code></td><td>
      <p>(boolean) Property not used. Access can be achieved by calling <code>unwrap</code> on the pooled connection.
         see <code>javax.sql.DataSource</code> interface, or call <code>getConnection</code> through reflection or
         cast the object as <code>javax.sql.PooledConnection</code></p>
    </td></tr><tr><td><code class="attributeName">removeAbandoned</code></td><td>
      <p>(boolean) Flag to remove abandoned connections if they exceed the <code>removeAbandonedTimeout</code>.
         If set to true a connection is considered abandoned and eligible for removal if it has been in use
         longer than the <code>removeAbandonedTimeout</code> Setting this to <code>true</code> can recover db connections from
         applications that fail to close a connection. See also <code>logAbandoned</code>
         The default value is <code>false</code>.</p>
    </td></tr><tr><td><code class="attributeName">removeAbandonedTimeout</code></td><td>
      <p>(int) Timeout in seconds before an abandoned(in use) connection can be removed.
         The default value is <code>60</code> (60 seconds). The value should be set to the longest running query your applications
         might have.</p>
    </td></tr><tr><td><code class="attributeName">logAbandoned</code></td><td>
      <p>(boolean) Flag to log stack traces for application code which abandoned a Connection.
         Logging of abandoned Connections adds overhead for every Connection borrow because a stack trace has to be generated.
         The default value is <code>false</code>.</p>
    </td></tr><tr><td><code class="attributeName">connectionProperties</code></td><td>
      <p>(String) The connection properties that will be sent to our JDBC driver when establishing new connections.
         Format of the string must be [propertyName=property;]*
         NOTE - The "user" and "password" properties will be passed explicitly, so they do not need to be included here.
         The default value is <code>null</code>.</p>
    </td></tr><tr><td><code class="attributeName">poolPreparedStatements</code></td><td>
      <p>(boolean) Property not used.</p>
    </td></tr><tr><td><code class="attributeName">maxOpenPreparedStatements</code></td><td>
      <p>(int) Property not used.</p>
    </td></tr></table>

  </div></div>

  <div class="subsection"><h4 id="Tomcat_JDBC_Enhanced_Attributes">Tomcat JDBC Enhanced Attributes</h4><div class="text">

  <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><code class="attributeName">initSQL</code></td><td>
      <p>(String) A custom query to be run when a connection is first created.
         The default value is <code>null</code>.</p>
    </td></tr><tr><td><code class="attributeName">jdbcInterceptors</code></td><td>
      <p>(String) A semicolon separated list of classnames extending
         <code>org.apache.tomcat.jdbc.pool.JdbcInterceptor</code> class.
         See <a href="#Configuring_JDBC_interceptors">Configuring JDBC interceptors</a>
         below for more detailed description of syntax and examples.
      </p>
      <p>
         These interceptors will be inserted as an interceptor into the chain
         of operations on a <code>java.sql.Connection</code> object.
         The default value is <code>null</code>.
      </p>
      <p>
         Predefined interceptors:<br>
         <code>org.apache.tomcat.jdbc.pool.interceptor.<br>ConnectionState</code>
          - keeps track of auto commit, read only, catalog and transaction isolation level.<br>
         <code>org.apache.tomcat.jdbc.pool.interceptor.<br>StatementFinalizer</code>
          - keeps track of opened statements, and closes them when the connection is returned to the pool.
      </p>
      <p>
         More predefined interceptors are described in detail in the
         <a href="#JDBC_interceptors">JDBC Interceptors section</a>.
      </p>
    </td></tr><tr><td><code class="attributeName">validationInterval</code></td><td>
      <p>(long) avoid excess validation, only run validation at most at this frequency - time in milliseconds.
         If a connection is due for validation, but has been validated previously within this interval, it will not be validated again.
         The default value is <code>3000</code> (3 seconds).</p>
    </td></tr><tr><td><code class="attributeName">jmxEnabled</code></td><td>
      <p>(boolean) Register the pool with JMX or not.
         The default value is <code>true</code>.</p>
    </td></tr><tr><td><code class="attributeName">fairQueue</code></td><td>
      <p>(boolean) Set to true if you wish that calls to getConnection should be treated
         fairly in a true FIFO fashion. This uses the <code>org.apache.tomcat.jdbc.pool.FairBlockingQueue</code>
         implementation for the list of the idle connections. The default value is <code>true</code>.
         This flag is required when you want to use asynchronous connection retrieval.<br>
         Setting this flag ensures that threads receive connections in the order they arrive.<br>
         During performance tests, there is a very large difference in how locks
         and lock waiting is implemented. When <code>fairQueue=true</code>
         there is a decision making process based on what operating system the system is running.
         If the system is running on Linux (property <code>os.name=Linux</code>.
         To disable this Linux specific behavior and still use the fair queue, simply add the property
         <code>org.apache.tomcat.jdbc.pool.FairBlockingQueue.ignoreOS=true</code> to your system properties
         before the connection pool classes are loaded.
      </p>
    </td></tr><tr><td><code class="attributeName">abandonWhenPercentageFull</code></td><td>
      <p>(int) Connections that have been abandoned (timed out) won't get closed and reported up unless
         the number of connections in use are above the percentage defined by <code>abandonWhenPercentageFull</code>.
         The value should be between 0-100.
         The default value is <code>0</code>, which implies that connections are eligible for closure as soon
         as <code>removeAbandonedTimeout</code> has been reached.</p>
    </td></tr><tr><td><code class="attributeName">maxAge</code></td><td>
      <p>(long) Time in milliseconds to keep this connection. This attribute
         works both when returning connection and when borrowing connection.
         When a connection is borrowed from the pool, the pool will check to see
         if the <code>now - time-when-connected &gt; maxAge</code> has been reached
         , and if so, it reconnects before borrow it. When a connection is
         returned to the pool, the pool will check to see if the
         <code>now - time-when-connected &gt; maxAge</code> has been reached, and
         if so, it closes the connection rather than returning it to the pool.
         The default value is <code>0</code>, which implies that connections
         will be left open and no age check will be done upon borrowing from the
         pool and returning the connection to the pool.</p>
    </td></tr><tr><td><code class="attributeName">useEquals</code></td><td>
      <p>(boolean) Set to true if you wish the <code>ProxyConnection</code> class to use <code>String.equals</code> and set to <code>false</code>
         when you wish to use <code>==</code> when comparing method names. This property does not apply to added interceptors as those are configured individually.
         The default value is <code>true</code>.
      </p>
    </td></tr><tr><td><code class="attributeName">suspectTimeout</code></td><td>
      <p>(int) Timeout value in seconds. Default value is <code>0</code>.<br>
           Similar to to the <code>removeAbandonedTimeout</code> value but instead of treating the connection
           as abandoned, and potentially closing the connection, this simply logs the warning if
           <code>logAbandoned</code> is set to true. If this value is equal or less than 0, no suspect
           checking will be performed. Suspect checking only takes place if the timeout value is larger than 0 and
           the connection was not abandoned or if abandon check is disabled. If a connection is suspect a WARN message gets
           logged and a JMX notification gets sent once.
      </p>
    </td></tr><tr><td><code class="attributeName">rollbackOnReturn</code></td><td>
      <p>(boolean) If <code>autoCommit==false</code> then the pool can terminate the transaction by calling rollback on the connection as it is returned to the pool
          Default value is <code>false</code>.<br>
      </p>
    </td></tr><tr><td><code class="attributeName">commitOnReturn</code></td><td>
      <p>(boolean) If <code>autoCommit==false</code> then the pool can complete the transaction by calling commit on the connection as it is returned to the pool
          If <code>rollbackOnReturn==true</code> then this attribute is ignored.
          Default value is <code>false</code>.<br>
      </p>
    </td></tr><tr><td><code class="attributeName">alternateUsernameAllowed</code></td><td>
      <p>(boolean) By default, the jdbc-pool will ignore the
         <a href="http://docs.oracle.com/javase/6/docs/api/javax/sql/DataSource.html#getConnection(java.lang.String,%20java.lang.String)"><code>DataSource.getConnection(username,password)</code></a>
         call, and simply return a previously pooled connection under the globally configured properties <code>username</code> and <code>password</code>, for performance reasons.
      </p>
      <p>
         The pool can however be configured to allow use of different credentials
         each time a connection is requested.  To enable the functionality described in the
         <a href="http://docs.oracle.com/javase/6/docs/api/javax/sql/DataSource.html#getConnection(java.lang.String,%20java.lang.String)"><code>DataSource.getConnection(username,password)</code></a>
         call, simply set the property <code>alternateUsernameAllowed</code>
         to <code>true</code>.<br>
         Should you request a connection with the credentials user1/password1 and the connection
         was previously connected using different user2/password2, the connection will be closed,
         and reopened with the requested credentials. This way, the pool size is still managed
         on a global level, and not on a per schema level. <br>
         The default value is <code>false</code>.<br>
         This property was added as an enhancement to <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=50025">bug 50025</a>.
      </p>
    </td></tr><tr><td><code class="attributeName">dataSource</code></td><td>
      <p>(javax.sql.DataSource) Inject a data source to the connection pool, and the pool will use the data source to retrieve connections instead of establishing them using the <code>java.sql.Driver</code> interface.
         This is useful when you wish to pool XA connections or connections established using a data source instead of a connection string. Default value is <code>null</code>
      </p>
    </td></tr><tr><td><code class="attributeName">dataSourceJNDI</code></td><td>
      <p>(String) The JNDI name for a data source to be looked up in JNDI and then used to establish connections to the database. See the <code>dataSource</code> attribute. Default value is <code>null</code>
      </p>
    </td></tr><tr><td><code class="attributeName">useDisposableConnectionFacade</code></td><td>
      <p>(boolean) Set this to true if you wish to put a facade on your connection so that it cannot be reused after it has been closed. This prevents a thread holding on to a
                   reference of a connection it has already called closed on, to execute queries on it. Default value is <code>true</code>.
      </p>
    </td></tr><tr><td><code class="attributeName">logValidationErrors</code></td><td>
      <p>(boolean) Set this to true to log errors during the validation phase to the log file. If set to true, errors will be logged as SEVERE. Default value is <code>false</code> for backwards compatibility.
      </p>
    </td></tr><tr><td><code class="attributeName">propagateInterruptState</code></td><td>
      <p>(boolean) Set this to true to propagate the interrupt state for a thread that has been interrupted (not clearing the interrupt state). Default value is <code>false</code> for backwards compatibility.
      </p>
    </td></tr><tr><td><code class="attributeName">ignoreExceptionOnPreLoad</code></td><td>
      <p>(boolean) Flag whether ignore error of connection creation while initializing the pool.
         Set to true if you want to ignore error of connection creation while initializing the pool.
         Set to false if you want to fail the initialization of the pool by throwing exception.
         The default value is <code>false</code>.
      </p>
    </td></tr><tr><td><code class="attributeName">useStatementFacade</code></td><td>
      <p>(boolean) Set this to true if you wish to wrap statements in order to
         enable <code>equals()</code> and <code>hashCode()</code> methods to be
         called on the closed statements if any statement proxy is set.
         Default value is <code>true</code>.
      </p>
    </td></tr></table>
  </div></div>
</div><h3 id="Advanced_usage">Advanced usage</h3><div class="text">
  <div class="subsection"><h4 id="JDBC_interceptors">JDBC interceptors</h4><div class="text">
    <p>To see an example of how to use an interceptor, take a look at
    <code>org.apache.tomcat.jdbc.pool.interceptor.ConnectionState</code>.
    This simple interceptor is a cache of three attributes, transaction isolation level, auto commit and read only state,
    in order for the system to avoid not needed roundtrips to the database.
    </p>
    <p>Further interceptors will be added to the core of the pool as the need arises. Contributions are always welcome!</p>
    <p>Interceptors are of course not limited to just <code>java.sql.Connection</code> but can be used to wrap any
    of the results from a method invocation as well. You could build query performance analyzer that provides JMX notifications when a
    query is running longer than the expected time.</p>
  </div></div>
  <div class="subsection"><h4 id="Configuring_JDBC_interceptors">Configuring JDBC interceptors</h4><div class="text">
    <p>Configuring JDBC interceptors is done using the <b>jdbcInterceptors</b> property.
    The property contains a list of semicolon separated class names. If the
    classname is not fully qualified it will be prefixed with the
    <code>org.apache.tomcat.jdbc.pool.interceptor.</code> prefix.
    </p>
    <p>Example:<br>
      <code>
      jdbcInterceptors="org.apache.tomcat.jdbc.pool.interceptor.ConnectionState;
        org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer"
      </code>
      <br>
      is the same as
      <br>
      <code> jdbcInterceptors="ConnectionState;StatementFinalizer"</code>
    </p>
    <p>
    Interceptors can have properties as well. Properties for an interceptor
    are specified within parentheses after the class name. Several properties
    are separated by commas.
    </p>
    <p>Example:<br>
    <code>
      jdbcInterceptors="ConnectionState;StatementFinalizer(useEquals=true)"
    </code>
    </p>
    <p>
    Extra whitespace characters around class names, property names and values
    are ignored.
    </p>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.JdbcInterceptor">org.apache.tomcat.jdbc.pool.JdbcInterceptor</h4><div class="text">
    <p>Abstract base class for all interceptors, cannot be instantiated.</p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><code class="attributeName">useEquals</code></td><td>
        <p>(boolean) Set to true if you wish the <code>ProxyConnection</code> class to use <code>String.equals</code> and set to <code>false</code>
         when you wish to use <code>==</code> when comparing method names.
         The default value is <code>true</code>.
        </p>
      </td></tr></table>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.interceptor.ConnectionState">org.apache.tomcat.jdbc.pool.interceptor.ConnectionState</h4><div class="text">
    <p>Caches the connection for the following attributes <code>autoCommit</code>, <code>readOnly</code>,
       <code>transactionIsolation</code> and <code>catalog</code>.
       It is a performance enhancement to avoid roundtrip to the database when getters are called or setters are called with an already set value.
    </p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr></table>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer">org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer</h4><div class="text">
    <p>Keeps track of all statements created using <code>createStatement</code>, <code>prepareStatement</code> or <code>prepareCall</code>
       and closes these statements when the connection is returned to the pool.
    </p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><code class="attributeName">trace</code></td><td>
        <p>(boolean as String) Enable tracing of unclosed statements.
           When enabled and a connection is closed, and statements are not closed,
           the interceptor will log all stack traces.
           The default value is <code>false</code>.
        </p>
      </td></tr></table>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.interceptor.StatementCache">org.apache.tomcat.jdbc.pool.interceptor.StatementCache</h4><div class="text">
    <p>Caches <code>PreparedStatement</code> and/or <code>CallableStatement</code>
       instances on a connection.
    </p>
    <p>The statements are cached per connection.
       The count limit is counted globally for all connections that belong to
       the same pool. Once the count reaches <code>max</code>, subsequent
       statements are not returned to the cache and are closed immediately.
    </p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><code class="attributeName">prepared</code></td><td>
        <p>(boolean as String) Enable caching of <code>PreparedStatement</code>
           instances created using <code>prepareStatement</code> calls.
           The default value is <code>true</code>.
        </p>
      </td></tr><tr><td><code class="attributeName">callable</code></td><td>
        <p>(boolean as String) Enable caching of <code>CallableStatement</code>
           instances created using <code>prepareCall</code> calls.
           The default value is <code>false</code>.
        </p>
      </td></tr><tr><td><code class="attributeName">max</code></td><td>
        <p>(int as String) Limit on the count of cached statements across
           the connection pool.
           The default value is <code>50</code>.
        </p>
      </td></tr></table>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.interceptor.StatementDecoratorInterceptor">org.apache.tomcat.jdbc.pool.interceptor.StatementDecoratorInterceptor</h4><div class="text">
    <p>See <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=48392">48392</a>. Interceptor to wrap statements and result sets in order to prevent access to the actual connection
       using the methods <code>ResultSet.getStatement().getConnection()</code> and <code>Statement.getConnection()</code>
    </p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr></table>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.interceptor.QueryTimeoutInterceptor">org.apache.tomcat.jdbc.pool.interceptor.QueryTimeoutInterceptor</h4><div class="text">
    <p>Automatically calls <code>java.sql.Statement.setQueryTimeout(seconds)</code> when a new statement is created.
       The pool itself doesn't timeout the query, it is still up to the JDBC driver to enforce query timeouts.
    </p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr><tr><td><strong><code class="attributeName">queryTimeout</code></strong></td><td>
        <p>(int as String) The number of seconds to set for the query timeout.
           A value less than or equal to zero will disable this feature.
           The default value is <code>1</code> seconds.
        </p>
      </td></tr></table>
  </div></div>
  <div class="subsection"><h4 id="org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReport">org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReport</h4><div class="text">
    <p>Keeps track of query performance and issues log entries when queries exceed a time threshold of fail.
       The log (ÍßÃ”Ò·∑nM±¢K¸‡ò.S§ùLÂ7sÛqÇ π(∆ü,æ;7≈•%~i/`€«BmPL «Ã;  ±çÄñ<π	±ç¡∆0DÒ &ViÆ$X›"FqT∆˝pÆ*jı¨-$î±.ó3vòO÷‚áƒ.∂!?/OÒ!sí?ÇÙ„ÿL.Aëß–jŒÙø 9~o¬í‰oö˘”xˇﬂÂÏ‰dË˘&¥\’ˇ)Í2›ŒRtä	Q€··Û÷“ö˝ÿÏ("Ã$/IL!ô;Hç≠+∂ç âÆ>a}üaÈ"≈ﬂß’Œ&€îÏ·ŸNÁ˜˜„ãá≈∂6†ú~$◊CóC◊íÇBƒ—
-ZR9JGÆ@äÆ˘Xf+oµ·úE«ºBÈˆ""ûé°≠Œ
∆m ∑˛¨·ÍM=å¥j∂t5]Æ:’∆PÎu∫üÀjxÍŒ˚eòFãq'c“ 4ÁB⁄›ë©7=Y'˘Ì'_w™Æ°ÇÈ7”˛9e«&= »]x˙ìuÌ€+∫€_äÔiä…Á9k¶≠‘Çøÿ˝å´∆c©¿âtèıª·ª§rl√¡uäüq∫±’*âK@Ñø≥6úW¨0È2÷ŸË+ª»@Gµù’ÿÖ`ÖÛ3i˘v„€èúÏßµ Ú„ÒúÄD≠»Ω_qã’Æ£¥—9»—~ºı√›≈o\ı≈ ≈TLëz1Ã1ü˛-Ä‰.õ“Ö„œÇÅ£Mmï“o@∞•6Kø√{⁄âfÌ<;~ËÎá™∞nm?⁄‡qû"≤X‰~…ÌZ‚y6ﬁ`öüjV\KU}Æ™x
y,	cÈê2Ü£JiGäÇ“Ñg$1á∆ÍÒ‹eg‡∆hî·¶é≈sqTñ‘àGU7ìpˇ&')7‰…™Ö…T®?ﬁhÈÀ|Ã7¥ß$·‘‡CÇËü«‚xù«åfäO/À—˙¯fÛáÀftß”tÆñ;\·kD]?H[OX<oc∏?ß˚p.vÑ∑åÏwﬁz°æ$êsÇw@F$ë¬ò˝ào„Y÷ …≥?≠ﬁ«ìCRë"[Yö@ù#ûæˇÍE	(+Œ>≈\p‰®Ÿ¯?≠E´•Í!~≈˙dìÑm:≤«`ﬁx:71æƒ–¥£å.⁄≥F§6UÆÜ-±˝7ÎS¥#–'LSì2Ø`8ˆfœ_µ¡#ø.E8˘b“˜˘œî_U Êa7æ6!êœaMp ˝	î¸h$q~(O.ØdcV‘!©6Úí‰€R‡•h≠ä=¿éCÅÄÌö˝£˛p6óÒ
≈¢2˝oøF^º¨"˚OÏ'¸èßˇã˝îuˇk@ZL£´°EÂ∑@É)⁄ê5@aÈ˘1_"i,¿wÀ§[f:Ê“∂ûã¸ˆìEQ¬„Ú•‡^¯¢ÙVﬂe~’sí◊ƒÏ˛ı—ÛgÄ¬äü7[ÅA€IQºøO™«©·T?ïêNé®ôQ¯†0Æ‰gºxyÙ"ñ‰&ºæ˝£¬u*¶ÓK´∫C<‹TCõ
ıúƒ±»≥Ú.Y‰f-6†ÁDÑ)ámˇi']ﬁ]J¡¥#ATó≈ìj∆É˛P9%·†√‹K1è÷`Á¥å—U6\ û[VÑØi‡¡È∂.SŒt5ˆÙÎ…‘c€¸#'<j4˜ÊóYÂØƒõ%IØ‘¡◊©ø`88∫*‹r C£ø*xÂf§_Å≥ïÏC;Ã˝ÄÒ:©ı3Ræi	ÈÕ-aÙrRÑõßÏ±À™Ì1ﬁ≈;˚iÊÁŒj ·ˆŒ/ª,ÄæEb°î˚X!∑h≤M\öB>≈>ó>¯õó†Á'M≈á–Ux≠óƒµÊHÙR±LLm†ÅF<Ú1P4æ¢æY¢‚ò&K¸ËPi‡–ÄÑe8SY™!¡á»r®¥åÔ7πZÛi⁄mX)1Rñ¶ˆ„ƒøÍ√∑‘oÙØ>åˇñhÅˇLbˆN∂Ü.ˇ«=yìv(å®aﬂã:EBÑ•{∞’,¥S ˝Aj‡®*®ÆÛ“O3»ÍÃV¿yœÜhë‡*èÅ	U¯‹≈ABùÇƒü|Ø≥';¯ﬂù∑(øúy*£ƒÂπ5±hqˆè…D∂ì3ªx5~«	@5·ÂbS+m†8“QÀü>˜ü€ü`Ñú≈I•në¶h·
uÛK¯®óﬁ˝êc‚FˇÃ0GÔ‚2™1‡Ë√H6ÂV	´_\^ˇÅjNÑ=1wFÇÃ6U5ËGr¿ òØB3W˝‰íı˛eM2KCæI∆¢µ•|´“ πó8≠¬µÊ¶$ÇM·wÎyJiÌ3ãœ¸⁄7ÚR#EÓ0T2Æ
ÆﬂÏlhq+πßIÚû∏lÁ¥Eò’±∆sù‚Í87óLæ9˚ñªŸï/‰i°J\%hàÉ˘v–Örà›¯`∆û–qF]·Ù◊}π—∞åÿÈ1Õk!Æ8V•qP%»vÄå∆üÿ† Í∫pŸ∂Úv…îäˆf„1¥º†Ç™Î”œë/6∏,B@lfo£ê–sXîF–∆Ÿ®3v^ˆ•i⁄0Ã^$J#Ø¥Áÿﬂ¿!‚Bev·E¯	ÙØ"ÆJÊ∫ÖJE˘O"ÈâD¡–…˘ÌÁ©’∞uPQ«Ú≥sKÓZ◊KBîê(ê.DJ@.®ETñ∏ “'Eî.doe€uzß«∑Œi5¥˙5[-ß©ıŸZµHŒA]r»Âû“„˘Wˇâ9à˘æ@pÕÙŸn Ó Æ∑‡»ºœsûıú}øÌæˆú]˜˘∏~˛	¢ãDR◊'Ãπ7ò¯# °’èâƒSiLY(öìÓ–ípÍµ(¡‹’GÚEÍµ1·$ƒGtÏ^HÒn˘á–ãVoú˝∆4…Qˆ‡ä¡6ìª‡n‹!*ÒQ˜`çàÎS“Qá…*π3⁄Ä’`ç†k»[–ò›Ê~¿.ûπ»Zº¡b%–ÃôáÚRO©±DpØ£ª∏πâ}më°òˆÄdGŸÅ[ÊmÛË¿ú>≥.Û>†lKé›2õ™ó!3÷≠»qÒe¡Ætæ=S ñí+Æ˝ÙÅ’)˝Ú!—–åä◊ÇÙæ}b bI™îkﬂL?j≤ı@k\èŸjúäúäÄíd8¬Ãv3Qbàµf=I‚â5+ÿ¨y« Tq—V¶À≠ªÅ‹j'µQè€éµıË≤(%À‰∑„%pı§‹:Øcı≤#r›ÈoìÖzØ(¢{6≈˝§Hdnj¸çºM´éœ»5∞€¬u©}tÓ“ÇÛÊw‹EYrh©˜í£cÓ˙≤P¶ë÷K´ùı˘ﬂ+€}æÁq∫[Ô⁄ÓW6ó+
6‹≠EÖù€—∆z´ÙÁªˆ“C“ØË≠•ê^5át…rí(äÃ€¶d∂Ø3ro[~ﬁÿÌ-„·ô2öíø5ÕN ’TìYP`¯]óË≥ã“¶SäY›Î?%ñ∞U÷˛xdWäU6®•S.'ªë.<z_ûmoà…FÀÒØ∫uı (tÌ(Æ„ßÿı]’Ñ6ùﬁ6˝&Z</»*é6ıÑÏΩé[H34œ\¶ˇÙ◊†?bÌá‹1Ï?ê±ºúáfnøFô∞®…m}˘¿
YΩá4°¶P¶∂ª¥À`±÷uã§e7Œâé»SΩF5›MÙp˜ñÀh0Û%Œbé≈‹at’òD›XA±à¨◊ ‹»∆)f„_0'&SSì∞ à~9€S
@´p˜62nmXì÷ÆÖ,´.Œ((æf√Ò»„pd
˙
	¡√úbÏCù‡√≈. (Éû◊o4%¿iXÔ2[∞ŒA¬Ÿàd Z`0oœﬂ¢ÄÚwa£±√Q5B¯ÖÂ[[d˘˝∆Ê‰`≤r€´S√È¸∫IQÃ≠gBR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’lcÂ∫»≠©œÖqÊ≤9àT£·Iê–2l€qÄ&üP%∑	KÕ´ß@Œ¶?m∑Ÿıçiÿ¶ÓŸ´8•q‰Uk'ﬂ{Jûe<0\åùŒK…f)Ù”;ÑF“‰’•d€=ÂÅ™-Â∫©FDA´≥.âÍÃ>‘ì(xòŒL’‘}h/˛ˆp¯háK’kŸ ◊ï›ã&$z<Ú˘¨Mø´eN‰ÓHÖ’yvwxñÌ’˛£Ÿñ;#	¸˚≤ƒ„^´aÊKdAï4ÂgA#ﬂ${åh_£cï˚Ã˙'P®O]˙zwout from the pool.
        B3W˝mı]smÛË¿ú>have a 30ª·ª§ timeout and run 10x10ª·ª§ ⁄‡qû"≤Xusing the connection
        it will be marked abandoned and potentially reK’kimed depending on the <code>abandonWhenPercentageFull</code>
        attribute.
        Using this interceptor it will ê2Üt the O]˙out t„^´aÊevery time ¿ú>perform an operation on the connection ™Ö…Txecute a
        Æ:’∆PÎsuccessfully.
    </p>
    <table class="defaultTable"><tr><th style="width: 15%;">
          Attribute
        </th><th style="width: 85%;">
          Description
        </th></tr></table>
  </div></div>
</div><h3 id="Code_Example">CoºM´Example</h3><div class="text">
  <p>Other examplesÓ0T2Ïlhq+πßIÚûfiguration for JDBC usage can be found <a href="https://ùŒK…f)apache.org/tomcat-8.5-doc/jndi-datasource-examples-how·
html">in2Æ
ÆﬂÏlhq+πßdocumentation</a>. </p>
  <BR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’P’kin_Ol'_Jt…r">P’kin Ol' Jt…rh/˛ˆp¯háK’kŸ ◊ï›ã&$z<Ú˘¨Mø´eNHere is a simple example of how to create and use a data source.</p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  imp
˙ java.sql.Connection;
  imp
˙ java.sql.ResultSet;
  imp
˙ java.sql.Statement;

  imp
˙ 'ﬂ{Jûe<0\åùŒK…f)Ù”;ÑF“‰’•dDataSource;
  imp
˙ 'ﬂ{Jûe<0\åùŒK…f)Ù”;ÑF“‰’•dPoolProperties;

  public˝‰íı˛eSimplePOJOExample {

      public˝static˝void mkin‹≠EÖù€[]›¯`gs) throws Exception {
          PoolProperties p = new PoolProperties();
          p.setUrl("±à¨◊mysql://localhost:3306/mysql");
          p.setDriverClassName("com.mysql.Ù”;ÑFDriver");
          p.setUsername("root");
          p.setPassword("password");
          p.setJmxEnabled(true);
          p.setTestWhileIdle(GŸÅ[Ê);
          p.setTestOnBorrow(true);
          p.setValidationÒ»„p("SELECT 1");
          p.setTestOnReturn(GŸÅ[Ê);
          p.setValidationInterval(30000);
          p.setTimeBetweenEvictionRunsMillis(30000);
          p.setMaxActive(100);
          p.setInitialSize(10);
          p.setMaxWait(10000);
          p.setRemoveAbandonedTimeout(60);
          p.setMinEvictableIdleTimeMillis(30000);
          p.setMinIdle(10);
          p.setLogAbandoned(true);
          p.setRemoveAbandoned(true);
          p.setJdbcInterceptors(É˛P9%·†√‹K1è"org.apache.tomcat.jdbc.pool.interceptor.ConnectionState;"+É˛P9%·†√‹K1è"org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer");
          DataSource datasource = new DataSource();
          datasource.setPoolProperties(p);

          Connection IÚû = null;
          t∆PÎ{É˛P9%·†√‹K1èIÚû = datasource.getConnection();É˛P9%·†√‹K1èStatement˝st = IÚû.createStatement();É˛P9%·†√‹K1èResultSet rs = st.TxecuteÒ»„p("select * from user");É˛P9%·†√‹K1èÇÅ£Mcnt = 1;É˛P9%·†√‹K1èwhile (rs.n›ã&())Î{É˛P9%·†√‹K1è‹K1èSystem.out.pEÖùtln((cnt++)+". Host:" +rs.getStEÖù€("Host")+É˛P9%·†√‹K1è‹K1è1è" User:"+rs.getStEÖù€("User")+" Password:"+rs.getStEÖù€("Password"));É˛P9%·†√‹K1è}É˛P9%·†√‹K1èrs.close();É˛P9%·†√‹K1èst.close();É˛P9%·†√‹K} finallPÎ{É˛P9%·†√‹K1èÛË(IÚû!=null) t∆PÎ{IÚû.close();}catch (Exception ignore)Î{}É˛P9%·†√‹K}É˛P9%·†}

  }¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠g≤r€´S√È¸∫IQÃ≠gBR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’As_a_Resource">As a Resource</h4><div class="text">
    <p>And here is an example on how to configure a resource for JNDI lookups</p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>&lt;Resource name="±à¨/TestDB"É˛P9%·†√‹Kauth="Con∏lÁ¥Eò"É˛P9%·†√‹K ‹»∆"javax.sql.DataSource"É˛P9%·†√‹Kfactory’lcÂ∫»≠©œÖqÊ≤9àT£·Iê–2l€qDataSourceFactory"É˛P9%·†√‹K estWhileIdle="true"É˛P9%·†√‹K estOnBorrow="true"É˛P9%·†√‹K estOnReturn="GŸÅ[Ê"É˛P9%·†√‹KvalidationQuery="SELECT 1"É˛P9%·†√‹KvalidationInterval="30000"É˛P9%·†√‹K imeBetweenEvictionRunsMillis="30000"É˛P9%·†√‹KmaxActive="100"É˛P9%·†√‹KminIdle="10"É˛P9%·†√‹KmaxWait="10000"É˛P9%·†√‹KinitialSize="10"É˛P9%·†√‹KremoveAbandonedTimeout="60"É˛P9%·†√‹KremoveAbandoned="true"É˛P9%·†√‹KlogAbandoned="true"É˛P9%·†√‹KminEvictableIdleTimeMillis="30000"É˛P9%·†√‹KjmxEnabled="true"É˛P9%·†√‹KjdbcInterceptors="org.apache.tomcat.jdbc.pool.interceptor.ConnectionState;
            org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer"
          username="root"
          password="password"
          driverClassName="com.mysql.Ù”;ÑFDriver"
          url="±à¨◊mysql://localhost:3306/mysql"/&gt;¶ë÷K´ùı˘Èê><√È¸∫IQÃQÃ≠g≤r€´S√È¸∫IQÃ≠gBR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’Asynchronous_Connection_Retrieval">Asynchronous Connection Retrieval</h4><div class="text">
    <p>ñÌ’˛Tomcat JDBC connection pool supp
˙s asynchronous connection retrievalûmoà…out adding *èÅ	U¯‹≈ﬁhÈhreads æ=S ñ
        pool library. It does this by adding * method to the data source called <code>FuO/À—&lt;Connection&gt; getConnectionAsync()</code>.
        IU}Æ™x
y,	cuse the async retrieval, two conÅ	U¯‹≈s must be met:
    </p>
        <ol>
          <li>You must configure the <code>fairQueue</code> property to be <code>true</code>.</li>
          <li>You will have to cast the data source to <code>org.apache.tomcat.jdbc.pool.DataSource</code></li>
        </ol>
        An example of using the async åfäO/À— is show below.
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  Connection IÚû = null;
  t∆PÎ{É˛P9%FuO/À—&lt;Connection&gt; fuO/À— = datasource.getConnectionAsync();
    while (!fuO/À—.isDone())Î{É˛P9%·†System.out.pEÖùtln("Connection is not yet available. Do some background Ì3ã");É˛P9%·†t∆PÎ{É˛P9%·†√Thread.sleep(100); //simulate Ì3ãÉ˛P9%·†}catch (InterruptedException x)Î{É˛P9%·†√Thread.curÑ=1wThread().interrupt();É˛P9%·†}É˛P9%}É˛P9%IÚû = fuO/À—.get(); //should return instantly
    Statement˝st = IÚû.createStatement();É˛P9%ResultSet rs = st.TxecuteÒ»„p("select * from user");¶ë÷K´ùı˘Èê><√È¸∫IQÃQÃ≠g≤r€´S√È¸∫IQÃ≠gBR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’Interceptors">Interceptors</h4><div class="text">
    <p>Interceptors are a powerful way to enable,‘‡CÇËü@5·Âbdify functionality on a specific connection ™Ö…\^ˇÅ∫v— components.
       There are many different use cases for A#ﬂ$interceptors are useful.óLæ9˚ñªŸï/and for performance reasons, the connection pool is state7ìpˇ1¥º†Ç™Î”œë/6only state the pool itself inserts are <code>d˚ñªŸïAutoCommit</code>, <code>d˚ñªŸïReadOnly</code>, <code>d˚ñªŸïTransactionIsolation</code>, <code>d˚ñªŸïCatalog</code> if
       these ¯`∆û–t. These 4 properties ar/6only set upon IÚûnection creation. Should these properties be mbdified during the usage 0T2Æ
Æﬂconnection,
       the pool itself will not ê2Üt them.</p>
    <p>An interceptor u∫üÀjxÍŒã:E the <code>org.apache.tomcat.jdbc.pool.JdbcInterceptor</code> class.ØB3W˝‰íı˛exù«åairly simple,
       You will need to have a no arg constructor</p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  public˝JdbcInterceptor()Î{É˛P}¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwxWhen a connection is borrowed from the pool, the interceptor can initializËü@5·in some other way I•në¶h· the event by implementing the
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  public˝abstract void r2Üt(1Õk!Æ8V•qP%»vjNÑ=1w, PooledConnection con);¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwxmethod. B3W˝mıthod gets called with two paramıters, a reference to the connection pool itself <code>CÕk!Æ8V•qP%»vjNÑ=1w</code>
       and a reference to the underlying connection <code>PooledConnection con</code>.
    </p>
    <p>
    vwxWhen a mıthod on the <code>java.sql.Connection</code> object is invoked, it will cause the
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  public˝Object invoke(Object proxy, Mıthod mıthod,˝Object[]›¯`gs) throws Throwable</code></Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwxmethod to get invoked.”œë/6∏,B@lMıthod mıthod</code> is the actual method invoked, and ∏,B@lObject[]›¯`gsnøFô∞®…mre the ¯`guments.
       To look at a very simple example, where w[H34monstrate how to make the invocation to <code>java.sql.Connection.close()nøFô∞®…m noop
       iT2Æ
Æﬂconnection has been closed
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  ÛË(CLOSE_VAL==method.getName())Î{É˛P9%·†ÛË(isClosed())Îreturn null; //noop for already closed.É˛P}É˛Preturn super.invoke(proxy,mıthod,¯`gs);¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwx There is an obÑ6ation being made. It is Æ
Æﬂcomparison of the method name. One way to do this would be to do
        <ë÷K´ù"close".equals(method.getName())</code>.
        Above we see a direct reference comparison between the method name and ∏,B@lstatic˝finalØ£ª∏πâ}nøFô∞®…reference.
        AccÆ™x“QÀü>˜ the JVM spec, method names and static˝finalØ£ª∏πâ} :E up in a shared const.Û>†pool, so the reference comparison should Ì3ã.
        One could of course do this as well:
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  ÛË(compare(CLOSE_VAL,mıthod))Î{É˛P9%·†ÛË(isClosed())Îreturn null; //noop for already closed.É˛P}É˛Preturn super.invoke(proxy,mıthod,¯`gs);¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwx The <code>compare(String,Mıthod)</code> will use the <code>useEquals</code> flag on an interceptor and do either reference comparison oﬁ6˝&Z</»*é6a ’TìYP◊†?bcomparison when the <code>useEquals=true</code> flag is set.
    </p>
    <p>qP%»vKdAï4/stop<br>
       When the connection pool is started or closed, ¿ú>can be 2õ™ed.”You will only be 2õ™ed once per interceptor c’kŸ 
       even à…ough∫pŸ∂Úvan instancexmethod. and you will be 2õ™ed using an interceptor curÑ=1wly not attached to a pool.
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  public˝void poolStarted(1Õk!Æ8V•qP%»vjP%»)Î{É˛P}

  public˝void poolClosed(1Õk!Æ8V•qP%»vjP%»)Î{É˛P}¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwxWhen overriding these methods, don't forgë°òˆÄdcall super iË¿ú>are extending a cíı˛eother ')7‰…<code>JdbcInterceptor</code>
    </p>
    <p>Configuring interceptors<br>
       Interceptors are configured using the <code>jdbcInterceptors</code> property or the ∏,B@lsetJdbcInterceptors</code> method.
       An interceptor can have properties, and would be configured likËü«‚xù
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  £ª∏πâ} jdbcInterceptors=
    "org.apache.tomcat.jdbc.pool.interceptor.ConnectionState(useEquals=true,fast=yes)"¶ë÷K´ùı˘Èê><√È¸∫IQÃQÃ≠g  <p>Interceptor properties<br>
       Since interceptors can have properties, ¿ú>need to be aCÇËü«o read the values of these properties within your
       interceptor. Taking an example likËü«‚/6one above, ¿ú>can override the ∏,B@lsetProperties</code> method.
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  public˝void setProperties(Map&lt;String, InterceptorProperty&gt; properties)Î{É˛P9%·super.setProperties(properties);É˛P9%·finalØ£ª∏πâ} myprop = "myprop";É˛P9%·InterceptorProperty p1 = properties.get(myprop);É˛P9%·ÛË(p1!=null) {É˛P9%·†√‹setMyprop(Long.parseLong(p1.getValue()));É˛P9%·}É˛P}¶ë÷K´ùı˘Èê><√È¸∫IQÃQÃ≠g≤r€´S√È¸∫IQÃ≠gBR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’Getting_the_actual_JDBC_connection">Getting the actual JDBC connection</h4><div class="text">
    <p>Connection pools create wrappers around the actual connection\KU}Æ™x
y,	cÈêoperly pool them.‰ÓHÖ’yvwxWe#Ø¥Áÿﬂcreate interceptors in these wrappers to be aCÇËü«o perform certkin functions.
       If there is a need to retrieve the actual connection,6one can do so using the <code>javax.sql.PooledConnection</code>
       interface.
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  Connection IÚû = datasource.getConnection();É˛PConnection actual = ((javax.sql.PooledConnection)con).getConnection();¶ë÷K´ùı˘Èê><√È¸∫IQÃQÃ≠g≤r€´S√È¸∫IQÃ
</div><h3 id="Building">Building</h3><div class="text">
  <p>We build the JDBC pool coºM´with 1.6, but pŸ∂Úvbackwards compatible down to 1.5 for runtime environ∂Ø3ro For unit test, we use 1.6 and higher</p>
  <p>Other examplesÓ0T2Ïlhq+πßIÚûfiguration for JDBC usage can be found <a href="https://ùŒK…f)apache.org/tomcat-8.5-doc/jndi-datasource-examples-how·
html">in2Æ
ÆﬂÏlhq+πßdocumentation</a>. </p>
  <BR{—©¥ñ%õ.V∫v—aa†2Zï%÷¿ã<8ı’Building_from_source">Building from source</h4><div class="text">
    <p>Building is pretty simple. The pool has a dependency on <code>tomcat-juli.jar</code> œÜhë‡case you want tñí+Æ˝ÙÅ’)˝Ú!—–åä◊ÇÙæ}b bI™îkﬂL</p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  javac -K’kŸ path tomcat-juli.jar \É˛P9%·†√-d . \É˛P9%·†√org/apache/tomcat/±à¨/pool/*.java \É˛P9%·†√org/apache/tomcat/±à¨/pool/interceptor/*.java \É˛P9%·†√org/apache/tomcat/±à¨/pool/jmx/*.java¶ë÷K´ùı˘Èê><√È¸∫IQÃ≠gMø´eN‰ÓHÖ’yvwxA build file can be found in2Æ
ÆﬂÏlhq+πß<a href="https://svnapache.org/viewvc/tomcat/trunk/modules/jdbc-pool/">source repos+m†8y</a>.
    </p>
    <p>
    vwAs a IÚûvenience, a build file is a¥Áÿﬂincluded where a simple build command will generate all files needed.
    </p>
p¯háK’kŸ ◊codeBo†ÅF<Èê><code>  ant download  (downloads dependencies)
  ant build     (compiles and generates .jar files)
  ant dist      (creates a release package)
  ant test      (runs tests, expects a test database to be setup)¶ë÷K´ùı˘Èê><√È¸∫IQÃQÃ≠g  <p>
    vwThe system is structured for a Maven build, but does generate release artifacts. Just the library itself.
    </p>
  </div></div>
</div></div></div></div></div><footer><div ı’footer">
    Copyright &copy; 1999-2023,wThe Apache Software Foundˆè…D∂ì3ªx5</div></footer></div></body></html>